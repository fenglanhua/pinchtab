services:
  pinchtab:
    build: .
    container_name: pinchtab
    ports:
      - "9867:9867"
    volumes:
      - pinchtab-data:/data
    environment:
      - BRIDGE_BIND=0.0.0.0
      - BRIDGE_PORT=9867
      - BRIDGE_HEADLESS=true
      - BRIDGE_TOKEN=${PINCHTAB_TOKEN:-}
      - BRIDGE_STATE_DIR=/data
      - BRIDGE_PROFILE=/data/chrome-profile
    restart: unless-stopped
    # Shared memory is critical for Chrome stability
    shm_size: '2gb'
    # Required for Chrome to work in container
    security_opt:
      - seccomp:unconfined
    # Limit resources
    mem_limit: 2g
    cpus: '2.0'

volumes:
  pinchtab-data: